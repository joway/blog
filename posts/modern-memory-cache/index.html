<!doctype html><html lang=en><meta charset=utf-8><meta name=generator content="Hugo 0.148.2"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Joway"><meta property="og:url" content="https://blog.joway.io/posts/modern-memory-cache/"><link rel=canonical href=https://blog.joway.io/posts/modern-memory-cache/><link rel=dns-prefetch href=https://cdn.jsdelivr.net/gh/joway/blog><link rel=apple-touch-icon href=/logo.png><link rel=icon href=/logo.png><link rel=shortcut href=/logo.png><link rel=alternate type=application/atom+xml href=https://blog.joway.io/index.xml title="Random Thoughts"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/blog.joway.io\/"},"articleSection":"posts","name":"è®¾è®¡å®ç°é«˜æ€§èƒ½æœ¬åœ°å†…å­˜ç¼“å­˜","headline":"è®¾è®¡å®ç°é«˜æ€§èƒ½æœ¬åœ°å†…å­˜ç¼“å­˜","description":"æœ¬åœ°å†…å­˜ç¼“å­˜æ˜¯ä¸€ä¸ªåœ¨åŸºç¡€è½¯ä»¶æ¶æ„ä¸­éå¸¸å¸¸è§çš„åŸºç¡€è®¾æ–½ï¼Œä¹Ÿæ­£å› å…¶è¿‡äºå¸¸è§ï¼Œä»¥è‡³äºå¹³æ—¶å¾ˆå°‘å»æ€è€ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚åœ¨å°šæœªè®¾è®¡ç¼“å­˜ç³»ç»Ÿå‰ï¼Œå®Œå…¨æ²¡æƒ³åˆ°åŸæ¥è¦éœ€è¦è€ƒè™‘å¦‚æ­¤å¤šå¤æ‚çš„äº‹æƒ…ã€‚æœ¬æ–‡å°†ç”±æµ…å…¥æ·±ä»‹ç»å¦‚ä½•è®¾è®¡ä¸€ä¸ªç°ä»£çš„é«˜æ€§èƒ½å†…å­˜ç¼“å­˜ç³»ç»Ÿã€‚\nä»€ä¹ˆæ—¶å€™éœ€è¦æœ¬åœ°å†…å­˜ç¼“å­˜ åœ¨å¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šä½¿ç”¨è¯¸å¦‚ Redisã€Memcached ç­‰è¿œç¨‹ç¼“å­˜ï¼Œä¸€æ–¹é¢å¯ä»¥é¿å…è‡ªèº«è¿›ç¨‹å†…å­˜å ç”¨è¿‡å¤§è€Œå¯¼è‡´çš„ OOM æˆ– GC é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å®ç°å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ä»½ä¸€è‡´çš„ç¼“å­˜æ•°æ®ã€‚ä½†å¯¹äºæŸäº›åº•å±‚æœåŠ¡ï¼ˆä¾‹å¦‚æ•°æ®åº“æœåŠ¡ï¼‰ï¼Œè¿œç¨‹ç¼“å­˜çš„ç½‘ç»œå»¶è¿Ÿæ˜¯ä¸å¯æ¥å—çš„ï¼Œè¿™å°±åŠ¿å¿…éœ€è¦å¼•å…¥æœ¬åœ°å†…å­˜ç¼“å­˜ã€‚\næœ¬åœ°å†…å­˜ç¼“å­˜çš„ç‰¹ç‚¹ æœ¬åœ°å†…å­˜ç¼“å­˜å¯è¢«è§†ä½œä¸€ä¸ªåŸºäºæœ¬åœ°å†…å­˜çš„ ã€ŒKeyValue æ•°æ®åº“ã€ã€‚ä½†ç›¸æ¯”è¾ƒäºä¼ ç»Ÿæ•°æ®åº“è€Œè¨€ï¼Œå®ƒå¯¹ä¸€è‡´æ€§çš„è¦æ±‚ååˆ†å®½æ¾ï¼š\nå¯¹äºæ›´æ–°ä¸åˆ é™¤çš„æ“ä½œï¼Œéœ€è¦ä¿è¯å¼ºä¸€è‡´æ€§ å¯¹äºæ’å…¥æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ä¸¢å¤± å¯¹äºè¯»å–æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ Miss ä¸ç£ç›˜æ•°æ®åº“çš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„åœ¨äºï¼Œç£ç›˜æ•°æ®åº“çš„è®¾è®¡æœ‰ä¸€ä¸ªå‰æå‡è®¾æ˜¯ç£ç›˜æ˜¯å¯ä»¥éšéœ€è¦è€Œä¸æ–­æ‰©å®¹çš„ï¼Œå€˜è‹¥ä¸€ä¸ªç£ç›˜æ•°æ®åº“å› ç£ç›˜å æ»¡è€Œå´©æºƒä¸»è¦è´£ä»»æ˜¯åœ¨ä½¿ç”¨æ–¹ã€‚è€Œå†…å­˜ç¼“å­˜åˆ™æ²¡æœ‰è¿™ä¹ˆå®½å®¹çš„å‡è®¾å¯ä»¥å»ºç«‹ï¼Œå®ƒå¿…é¡»è€ƒè™‘åˆ°å†…å­˜æ˜¯æ˜‚è´µä¸”æœ‰é™çš„è¿™ä¸€äº‹å®ã€‚\né™¤æ­¤ä¹‹å¤–ï¼Œç”±äºæœ¬åœ°å†…å­˜ç¼“å­˜å¤„äºä¸šåŠ¡è¿›ç¨‹å½“ä¸­ï¼Œæ‰€ä»¥å…¶éœ€è¦è€ƒè™‘æ›´å¤šä¸šåŠ¡å‘çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š\nç”±äºè‡ªèº«å¤§é‡è€ç”Ÿä»£çš„å†…å­˜å ç”¨ï¼Œæ˜¯å¦ä¼šå¯¹æ‰€å¤„è¿›ç¨‹äº§ç”Ÿ GC é—®é¢˜ã€‚ å½“å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åŒæ—¶è§£å†³çº¿ç¨‹å®‰å…¨ã€æ•°æ®ç«äº‰ã€é«˜ååç­‰é—®é¢˜ã€‚ éœ€è¦èƒ½å¤Ÿé€‚åº”ä¸€äº›ééšæœºçš„è®¿é—®ç»Ÿè®¡è§„å¾‹ï¼Œä¾‹å¦‚ Zipfã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³å‡ºå¯¹ä¸€ä¸ªä¼˜ç§€çš„æœ¬åœ°å†…å­˜ç¼“å­˜ç³»ç»Ÿçš„è¦æ±‚ï¼š\nçº¿ç¨‹å®‰å…¨ é«˜åå é«˜å‘½ä¸­ç‡ æ”¯æŒå†…å­˜é™åˆ¶ å®ç°è·¯å¾„ åœ¨å®ç°ä¸€ä¸ªå®Œæ•´çš„ç¼“å­˜ç³»ç»Ÿå‰ï¼Œæˆ‘ä»¬éœ€è¦å°†ç›®æ ‡ä¸€æ­¥æ­¥æ‹†è§£ã€‚\né¦–å…ˆä¸ºäº†å®ç°ç¼“å­˜é€»è¾‘ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç±» Map çš„ KeyValue æ•°æ®ç»“æ„ï¼ŒåŒæ—¶å®ƒå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸ºäº†æ”¯æŒå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦èƒ½å¤Ÿé©±é€ä¸€äº› keyï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªé©±é€å™¨ã€‚ä¸ºäº†å®ç°é©±é€çš„åŒæ—¶ç»´æŒé«˜å‘½ä¸­ç‡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰é©±é€å™¨æ¯ä¸ª key çš„è®¿é—®è®°å½•ï¼Œè®©å®ƒèƒ½å¤Ÿä»ä¸­åˆ†æå‡ºå“ªäº› key å¯ä»¥è¢«é©±é€ã€‚ç»¼ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ•´ç†å‡ºä¸€ä¸ªå¤§æ¦‚çš„ Roadmapï¼š\nå®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Map æ•°æ®ç»“æ„ï¼šå­˜å‚¨ç¼“å­˜å†…å®¹ å®ç°ä¸€ä¸ªè®¿é—®è®°å½•é˜Ÿåˆ—ï¼šå­˜å‚¨è®¿é—®è®°å½• å®ç°ä¸€ä¸ªé©±é€å™¨ï¼šç®¡ç†ç¼“å­˜å†…å®¹ æœ¬æ–‡æ‰€æœ‰ä»£ç å‡ä½¿ç”¨ Golang ç¼–å†™ã€‚\nçº¿ç¨‹å®‰å…¨çš„ Map ç®€æ˜“çš„ Map cache := map[string]string{} cache[\u0026quot;a\u0026quot;] = \u0026quot;b\u0026quot; åœ¨ key æ•°é‡å›ºå®šä¸”æå°‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åŸç”Ÿ Map ç›´æ¥å®ç°ä¸€ä¸ªæœ€ç®€å•ç¼“å­˜ã€‚ä½† Golang åŸç”Ÿ Map å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å¤šä¸ª goroutine åŒæ—¶è¯»å†™è¯¥å¯¹è±¡æ—¶ï¼Œä¼šå‘ç”Ÿå†²çªã€‚\n","inLanguage":"en-US","author":"Joway","creator":"Joway","publisher":"Joway","accountablePerson":"Joway","copyrightHolder":"Joway","copyrightYear":"2019","datePublished":"2019-11-10 00:00:00 \u002b0000 UTC","dateModified":"2019-11-10 00:00:00 \u002b0000 UTC","url":"https:\/\/blog.joway.io\/posts\/modern-memory-cache\/","keywords":[]}</script><title>è®¾è®¡å®ç°é«˜æ€§èƒ½æœ¬åœ°å†…å­˜ç¼“å­˜</title><meta property="og:title" content="è®¾è®¡å®ç°é«˜æ€§èƒ½æœ¬åœ°å†…å­˜ç¼“å­˜"><meta property="og:type" content="article"><meta property="og:description" content='æœ¬åœ°å†…å­˜ç¼“å­˜æ˜¯ä¸€ä¸ªåœ¨åŸºç¡€è½¯ä»¶æ¶æ„ä¸­éå¸¸å¸¸è§çš„åŸºç¡€è®¾æ–½ï¼Œä¹Ÿæ­£å› å…¶è¿‡äºå¸¸è§ï¼Œä»¥è‡³äºå¹³æ—¶å¾ˆå°‘å»æ€è€ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚åœ¨å°šæœªè®¾è®¡ç¼“å­˜ç³»ç»Ÿå‰ï¼Œå®Œå…¨æ²¡æƒ³åˆ°åŸæ¥è¦éœ€è¦è€ƒè™‘å¦‚æ­¤å¤šå¤æ‚çš„äº‹æƒ…ã€‚æœ¬æ–‡å°†ç”±æµ…å…¥æ·±ä»‹ç»å¦‚ä½•è®¾è®¡ä¸€ä¸ªç°ä»£çš„é«˜æ€§èƒ½å†…å­˜ç¼“å­˜ç³»ç»Ÿã€‚
ä»€ä¹ˆæ—¶å€™éœ€è¦æœ¬åœ°å†…å­˜ç¼“å­˜ åœ¨å¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šä½¿ç”¨è¯¸å¦‚ Redisã€Memcached ç­‰è¿œç¨‹ç¼“å­˜ï¼Œä¸€æ–¹é¢å¯ä»¥é¿å…è‡ªèº«è¿›ç¨‹å†…å­˜å ç”¨è¿‡å¤§è€Œå¯¼è‡´çš„ OOM æˆ– GC é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å®ç°å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ä»½ä¸€è‡´çš„ç¼“å­˜æ•°æ®ã€‚ä½†å¯¹äºæŸäº›åº•å±‚æœåŠ¡ï¼ˆä¾‹å¦‚æ•°æ®åº“æœåŠ¡ï¼‰ï¼Œè¿œç¨‹ç¼“å­˜çš„ç½‘ç»œå»¶è¿Ÿæ˜¯ä¸å¯æ¥å—çš„ï¼Œè¿™å°±åŠ¿å¿…éœ€è¦å¼•å…¥æœ¬åœ°å†…å­˜ç¼“å­˜ã€‚
æœ¬åœ°å†…å­˜ç¼“å­˜çš„ç‰¹ç‚¹ æœ¬åœ°å†…å­˜ç¼“å­˜å¯è¢«è§†ä½œä¸€ä¸ªåŸºäºæœ¬åœ°å†…å­˜çš„ ã€ŒKeyValue æ•°æ®åº“ã€ã€‚ä½†ç›¸æ¯”è¾ƒäºä¼ ç»Ÿæ•°æ®åº“è€Œè¨€ï¼Œå®ƒå¯¹ä¸€è‡´æ€§çš„è¦æ±‚ååˆ†å®½æ¾ï¼š
å¯¹äºæ›´æ–°ä¸åˆ é™¤çš„æ“ä½œï¼Œéœ€è¦ä¿è¯å¼ºä¸€è‡´æ€§ å¯¹äºæ’å…¥æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ä¸¢å¤± å¯¹äºè¯»å–æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ Miss ä¸ç£ç›˜æ•°æ®åº“çš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„åœ¨äºï¼Œç£ç›˜æ•°æ®åº“çš„è®¾è®¡æœ‰ä¸€ä¸ªå‰æå‡è®¾æ˜¯ç£ç›˜æ˜¯å¯ä»¥éšéœ€è¦è€Œä¸æ–­æ‰©å®¹çš„ï¼Œå€˜è‹¥ä¸€ä¸ªç£ç›˜æ•°æ®åº“å› ç£ç›˜å æ»¡è€Œå´©æºƒä¸»è¦è´£ä»»æ˜¯åœ¨ä½¿ç”¨æ–¹ã€‚è€Œå†…å­˜ç¼“å­˜åˆ™æ²¡æœ‰è¿™ä¹ˆå®½å®¹çš„å‡è®¾å¯ä»¥å»ºç«‹ï¼Œå®ƒå¿…é¡»è€ƒè™‘åˆ°å†…å­˜æ˜¯æ˜‚è´µä¸”æœ‰é™çš„è¿™ä¸€äº‹å®ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºæœ¬åœ°å†…å­˜ç¼“å­˜å¤„äºä¸šåŠ¡è¿›ç¨‹å½“ä¸­ï¼Œæ‰€ä»¥å…¶éœ€è¦è€ƒè™‘æ›´å¤šä¸šåŠ¡å‘çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š
ç”±äºè‡ªèº«å¤§é‡è€ç”Ÿä»£çš„å†…å­˜å ç”¨ï¼Œæ˜¯å¦ä¼šå¯¹æ‰€å¤„è¿›ç¨‹äº§ç”Ÿ GC é—®é¢˜ã€‚ å½“å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åŒæ—¶è§£å†³çº¿ç¨‹å®‰å…¨ã€æ•°æ®ç«äº‰ã€é«˜ååç­‰é—®é¢˜ã€‚ éœ€è¦èƒ½å¤Ÿé€‚åº”ä¸€äº›ééšæœºçš„è®¿é—®ç»Ÿè®¡è§„å¾‹ï¼Œä¾‹å¦‚ Zipfã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³å‡ºå¯¹ä¸€ä¸ªä¼˜ç§€çš„æœ¬åœ°å†…å­˜ç¼“å­˜ç³»ç»Ÿçš„è¦æ±‚ï¼š
çº¿ç¨‹å®‰å…¨ é«˜åå é«˜å‘½ä¸­ç‡ æ”¯æŒå†…å­˜é™åˆ¶ å®ç°è·¯å¾„ åœ¨å®ç°ä¸€ä¸ªå®Œæ•´çš„ç¼“å­˜ç³»ç»Ÿå‰ï¼Œæˆ‘ä»¬éœ€è¦å°†ç›®æ ‡ä¸€æ­¥æ­¥æ‹†è§£ã€‚
é¦–å…ˆä¸ºäº†å®ç°ç¼“å­˜é€»è¾‘ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç±» Map çš„ KeyValue æ•°æ®ç»“æ„ï¼ŒåŒæ—¶å®ƒå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸ºäº†æ”¯æŒå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦èƒ½å¤Ÿé©±é€ä¸€äº› keyï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªé©±é€å™¨ã€‚ä¸ºäº†å®ç°é©±é€çš„åŒæ—¶ç»´æŒé«˜å‘½ä¸­ç‡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰é©±é€å™¨æ¯ä¸ª key çš„è®¿é—®è®°å½•ï¼Œè®©å®ƒèƒ½å¤Ÿä»ä¸­åˆ†æå‡ºå“ªäº› key å¯ä»¥è¢«é©±é€ã€‚ç»¼ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ•´ç†å‡ºä¸€ä¸ªå¤§æ¦‚çš„ Roadmapï¼š
å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Map æ•°æ®ç»“æ„ï¼šå­˜å‚¨ç¼“å­˜å†…å®¹ å®ç°ä¸€ä¸ªè®¿é—®è®°å½•é˜Ÿåˆ—ï¼šå­˜å‚¨è®¿é—®è®°å½• å®ç°ä¸€ä¸ªé©±é€å™¨ï¼šç®¡ç†ç¼“å­˜å†…å®¹ æœ¬æ–‡æ‰€æœ‰ä»£ç å‡ä½¿ç”¨ Golang ç¼–å†™ã€‚
çº¿ç¨‹å®‰å…¨çš„ Map ç®€æ˜“çš„ Map cache := map[string]string{} cache["a"] = "b" åœ¨ key æ•°é‡å›ºå®šä¸”æå°‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åŸç”Ÿ Map ç›´æ¥å®ç°ä¸€ä¸ªæœ€ç®€å•ç¼“å­˜ã€‚ä½† Golang åŸç”Ÿ Map å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å¤šä¸ª goroutine åŒæ—¶è¯»å†™è¯¥å¯¹è±¡æ—¶ï¼Œä¼šå‘ç”Ÿå†²çªã€‚
'><meta name=description content='æœ¬åœ°å†…å­˜ç¼“å­˜æ˜¯ä¸€ä¸ªåœ¨åŸºç¡€è½¯ä»¶æ¶æ„ä¸­éå¸¸å¸¸è§çš„åŸºç¡€è®¾æ–½ï¼Œä¹Ÿæ­£å› å…¶è¿‡äºå¸¸è§ï¼Œä»¥è‡³äºå¹³æ—¶å¾ˆå°‘å»æ€è€ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚åœ¨å°šæœªè®¾è®¡ç¼“å­˜ç³»ç»Ÿå‰ï¼Œå®Œå…¨æ²¡æƒ³åˆ°åŸæ¥è¦éœ€è¦è€ƒè™‘å¦‚æ­¤å¤šå¤æ‚çš„äº‹æƒ…ã€‚æœ¬æ–‡å°†ç”±æµ…å…¥æ·±ä»‹ç»å¦‚ä½•è®¾è®¡ä¸€ä¸ªç°ä»£çš„é«˜æ€§èƒ½å†…å­˜ç¼“å­˜ç³»ç»Ÿã€‚
ä»€ä¹ˆæ—¶å€™éœ€è¦æœ¬åœ°å†…å­˜ç¼“å­˜ åœ¨å¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šä½¿ç”¨è¯¸å¦‚ Redisã€Memcached ç­‰è¿œç¨‹ç¼“å­˜ï¼Œä¸€æ–¹é¢å¯ä»¥é¿å…è‡ªèº«è¿›ç¨‹å†…å­˜å ç”¨è¿‡å¤§è€Œå¯¼è‡´çš„ OOM æˆ– GC é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å®ç°å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ä»½ä¸€è‡´çš„ç¼“å­˜æ•°æ®ã€‚ä½†å¯¹äºæŸäº›åº•å±‚æœåŠ¡ï¼ˆä¾‹å¦‚æ•°æ®åº“æœåŠ¡ï¼‰ï¼Œè¿œç¨‹ç¼“å­˜çš„ç½‘ç»œå»¶è¿Ÿæ˜¯ä¸å¯æ¥å—çš„ï¼Œè¿™å°±åŠ¿å¿…éœ€è¦å¼•å…¥æœ¬åœ°å†…å­˜ç¼“å­˜ã€‚
æœ¬åœ°å†…å­˜ç¼“å­˜çš„ç‰¹ç‚¹ æœ¬åœ°å†…å­˜ç¼“å­˜å¯è¢«è§†ä½œä¸€ä¸ªåŸºäºæœ¬åœ°å†…å­˜çš„ ã€ŒKeyValue æ•°æ®åº“ã€ã€‚ä½†ç›¸æ¯”è¾ƒäºä¼ ç»Ÿæ•°æ®åº“è€Œè¨€ï¼Œå®ƒå¯¹ä¸€è‡´æ€§çš„è¦æ±‚ååˆ†å®½æ¾ï¼š
å¯¹äºæ›´æ–°ä¸åˆ é™¤çš„æ“ä½œï¼Œéœ€è¦ä¿è¯å¼ºä¸€è‡´æ€§ å¯¹äºæ’å…¥æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ä¸¢å¤± å¯¹äºè¯»å–æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ Miss ä¸ç£ç›˜æ•°æ®åº“çš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„åœ¨äºï¼Œç£ç›˜æ•°æ®åº“çš„è®¾è®¡æœ‰ä¸€ä¸ªå‰æå‡è®¾æ˜¯ç£ç›˜æ˜¯å¯ä»¥éšéœ€è¦è€Œä¸æ–­æ‰©å®¹çš„ï¼Œå€˜è‹¥ä¸€ä¸ªç£ç›˜æ•°æ®åº“å› ç£ç›˜å æ»¡è€Œå´©æºƒä¸»è¦è´£ä»»æ˜¯åœ¨ä½¿ç”¨æ–¹ã€‚è€Œå†…å­˜ç¼“å­˜åˆ™æ²¡æœ‰è¿™ä¹ˆå®½å®¹çš„å‡è®¾å¯ä»¥å»ºç«‹ï¼Œå®ƒå¿…é¡»è€ƒè™‘åˆ°å†…å­˜æ˜¯æ˜‚è´µä¸”æœ‰é™çš„è¿™ä¸€äº‹å®ã€‚
é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºæœ¬åœ°å†…å­˜ç¼“å­˜å¤„äºä¸šåŠ¡è¿›ç¨‹å½“ä¸­ï¼Œæ‰€ä»¥å…¶éœ€è¦è€ƒè™‘æ›´å¤šä¸šåŠ¡å‘çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š
ç”±äºè‡ªèº«å¤§é‡è€ç”Ÿä»£çš„å†…å­˜å ç”¨ï¼Œæ˜¯å¦ä¼šå¯¹æ‰€å¤„è¿›ç¨‹äº§ç”Ÿ GC é—®é¢˜ã€‚ å½“å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åŒæ—¶è§£å†³çº¿ç¨‹å®‰å…¨ã€æ•°æ®ç«äº‰ã€é«˜ååç­‰é—®é¢˜ã€‚ éœ€è¦èƒ½å¤Ÿé€‚åº”ä¸€äº›ééšæœºçš„è®¿é—®ç»Ÿè®¡è§„å¾‹ï¼Œä¾‹å¦‚ Zipfã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³å‡ºå¯¹ä¸€ä¸ªä¼˜ç§€çš„æœ¬åœ°å†…å­˜ç¼“å­˜ç³»ç»Ÿçš„è¦æ±‚ï¼š
çº¿ç¨‹å®‰å…¨ é«˜åå é«˜å‘½ä¸­ç‡ æ”¯æŒå†…å­˜é™åˆ¶ å®ç°è·¯å¾„ åœ¨å®ç°ä¸€ä¸ªå®Œæ•´çš„ç¼“å­˜ç³»ç»Ÿå‰ï¼Œæˆ‘ä»¬éœ€è¦å°†ç›®æ ‡ä¸€æ­¥æ­¥æ‹†è§£ã€‚
é¦–å…ˆä¸ºäº†å®ç°ç¼“å­˜é€»è¾‘ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç±» Map çš„ KeyValue æ•°æ®ç»“æ„ï¼ŒåŒæ—¶å®ƒå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸ºäº†æ”¯æŒå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦èƒ½å¤Ÿé©±é€ä¸€äº› keyï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªé©±é€å™¨ã€‚ä¸ºäº†å®ç°é©±é€çš„åŒæ—¶ç»´æŒé«˜å‘½ä¸­ç‡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰é©±é€å™¨æ¯ä¸ª key çš„è®¿é—®è®°å½•ï¼Œè®©å®ƒèƒ½å¤Ÿä»ä¸­åˆ†æå‡ºå“ªäº› key å¯ä»¥è¢«é©±é€ã€‚ç»¼ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ•´ç†å‡ºä¸€ä¸ªå¤§æ¦‚çš„ Roadmapï¼š
å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Map æ•°æ®ç»“æ„ï¼šå­˜å‚¨ç¼“å­˜å†…å®¹ å®ç°ä¸€ä¸ªè®¿é—®è®°å½•é˜Ÿåˆ—ï¼šå­˜å‚¨è®¿é—®è®°å½• å®ç°ä¸€ä¸ªé©±é€å™¨ï¼šç®¡ç†ç¼“å­˜å†…å®¹ æœ¬æ–‡æ‰€æœ‰ä»£ç å‡ä½¿ç”¨ Golang ç¼–å†™ã€‚
çº¿ç¨‹å®‰å…¨çš„ Map ç®€æ˜“çš„ Map cache := map[string]string{} cache["a"] = "b" åœ¨ key æ•°é‡å›ºå®šä¸”æå°‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åŸç”Ÿ Map ç›´æ¥å®ç°ä¸€ä¸ªæœ€ç®€å•ç¼“å­˜ã€‚ä½† Golang åŸç”Ÿ Map å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å¤šä¸ª goroutine åŒæ—¶è¯»å†™è¯¥å¯¹è±¡æ—¶ï¼Œä¼šå‘ç”Ÿå†²çªã€‚
'><meta property="og:locale" content="cn"><meta property="og:image" content="/logo.png"><style>:root{--bg-color:#ffffff;--text-color:#000000;--link-color:#000000;--border-color:#482936;--secondary-text:#666666;--code-bg:#f6f8fa;--blockquote-color:#57606a;--blockquote-border:#d0d7de;--disqus-bg:white}[data-theme=dark]{--bg-color:#1a1a1a;--text-color:#e0e0e0;--link-color:#b0b0b0;--border-color:#8b5a7a;--secondary-text:#aaaaaa;--code-bg:#2d2d2d;--blockquote-color:#a0a0a0;--blockquote-border:#404040;--disqus-bg:#1a1a1a}body{font-family:bree serif,sans-serif;-webkit-font-smoothing:antialiased;margin:0 20px;background-color:var(--bg-color);color:var(--text-color)}article{max-width:800px;margin-left:auto;margin-right:auto}a{color:var(--link-color);text-decoration:none}a:hover{font-weight:600;text-decoration:underline}.post-ads{margin:50px 0}.markdown-body{font-size:18px;max-width:100%}.markdown-body a{text-decoration:underline;text-decoration-color:var(--link-color)}.markdown-body blockquote{margin:0;padding:0 1em;color:var(--blockquote-color);border-left:.25em solid var(--blockquote-border)}.markdown-body pre{padding:16px;overflow:auto;border-radius:10px;background-color:var(--code-bg)}.markdown-body code{padding:.2em .4em;font-size:85%;background-color:var(--code-bg);border-radius:6px}.markdown-body pre>code{padding:0;font-size:100%;background-color:var(--code-bg);border:0}.Chinese .markdown-body{line-height:200%}.site-date-catalog{font-size:2rem}.header-title{font-size:2rem;font-weight:700;margin-top:32px;font-family:bungee shade,sans-serif}.header-title a{text-decoration:none}.header-subtitle{color:var(--secondary-text)}.header-items{margin:10px 0}.header-item{margin:0 5px}.header-line{width:100%;border-width:2px;border-color:var(--border-color);border-style:solid none none none}.lang-switch{font-weight:600}.theme-toggle{background:0 0;border:none;color:var(--link-color);cursor:pointer;font-weight:600;font-size:inherit;padding:0}.theme-toggle:hover{font-weight:800}#posts-list{min-height:600px}.posts-line{font-size:1.2rem;margin:12px 0}.posts-categories{font-size:.8rem;margin:auto;text-align:center}.posts-category{padding:3px 0;border:var(--text-color)2px solid;border-radius:5px}.site-footer{margin-top:50px}.site-footer-item{margin-right:12px}.post-header{margin-bottom:50px}.post-title{font-size:2rem;font-weight:600}.post-tags{display:inline;font-weight:600;padding:2px 5px;margin-right:6px;border:var(--text-color)2px solid;border-radius:5px}.post-date{font-weight:800;font-style:italic}.post-author{float:right;font-weight:600}.page-content{min-height:60%}.post-content{margin-bottom:50px}.post-content p{hyphens:auto;line-height:1.8;text-justify:ideographic;margin-bottom:1em}.post-content img{max-width:100%;display:block;margin-right:auto;margin-top:6px}.post-content .post-gallery{display:flex;flex-wrap:wrap;gap:6px}.post-content .post-gallery img{margin-right:auto;margin-top:auto;width:calc(50% - 3px)}.related-content{border-width:3px;border-style:solid;border-color:var(--text-color);padding:0 10px;margin-bottom:50px;margin-top:100px}.related-content li{margin:5px 0}.taxonomy-term{font-size:3rem}.gallery-img{text-align:center}.gallery-img span{text-align:center}.gallery-img-desc{font-size:.8em;font-weight:800}#disqus_thread{position:relative}#disqus_thread:after{content:"";display:block;height:55px;width:100%;position:absolute;bottom:0;background:var(--disqus-bg)}@media screen and (max-width:600px){.header-title,.header-subtitle,.header-items{}.posts-line{font-size:16px}.markdown-body{font-size:16px}.post-title{font-size:2rem}.post-content p{letter-spacing:.05em}.post-content .post-gallery img{width:100%}}@media screen and (max-width:48em){.posts-category{display:none}}</style><style>.container,.container-fluid{margin-right:auto;margin-left:auto}.container-fluid{padding-right:2rem;padding-left:2rem}.row{box-sizing:border-box;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-flex:0;-ms-flex:0 1 auto;flex:initial;-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5rem;margin-left:-.5rem}.row.reverse{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.col.reverse{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.col-xs,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9,.col-xs-offset-0,.col-xs-offset-1,.col-xs-offset-10,.col-xs-offset-11,.col-xs-offset-12,.col-xs-offset-2,.col-xs-offset-3,.col-xs-offset-4,.col-xs-offset-5,.col-xs-offset-6,.col-xs-offset-7,.col-xs-offset-8,.col-xs-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-xs{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-xs-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-xs-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-xs-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-xs-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-xs-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-xs-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-xs-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-xs-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-xs-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-xs-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-xs-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-xs-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-xs-offset-0{margin-left:0}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-11{margin-left:91.66666667%}.start-xs{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-xs{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-xs{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-xs{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-xs{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-xs{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-xs{-ms-flex-pack:distribute;justify-content:space-around}.between-xs{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-xs{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-xs{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}@media only screen and (min-width:48em){.container{width:49rem}.col-sm,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-sm-offset-0,.col-sm-offset-1,.col-sm-offset-10,.col-sm-offset-11,.col-sm-offset-12,.col-sm-offset-2,.col-sm-offset-3,.col-sm-offset-4,.col-sm-offset-5,.col-sm-offset-6,.col-sm-offset-7,.col-sm-offset-8,.col-sm-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-sm{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-sm-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-sm-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-sm-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-sm-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-sm-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-sm-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-sm-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-sm-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-sm-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-sm-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-sm-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-sm-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-sm-offset-0{margin-left:0}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-11{margin-left:91.66666667%}.start-sm{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-sm{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-sm{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-sm{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-sm{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-sm{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-sm{-ms-flex-pack:distribute;justify-content:space-around}.between-sm{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-sm{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-sm{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:64em){.container{width:65rem}.col-md,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-md-offset-0,.col-md-offset-1,.col-md-offset-10,.col-md-offset-11,.col-md-offset-12,.col-md-offset-2,.col-md-offset-3,.col-md-offset-4,.col-md-offset-5,.col-md-offset-6,.col-md-offset-7,.col-md-offset-8,.col-md-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-md{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-md-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-md-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-md-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-md-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-md-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-md-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-md-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-md-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-md-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-md-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-md-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-md-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-md-offset-0{margin-left:0}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-3{margin-left:25%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-6{margin-left:50%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-9{margin-left:75%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-11{margin-left:91.66666667%}.start-md{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-md{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-md{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-md{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-md{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-md{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-md{-ms-flex-pack:distribute;justify-content:space-around}.between-md{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-md{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-md{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}@media only screen and (min-width:75em){.container{width:76rem}.col-lg,.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-lg-offset-0,.col-lg-offset-1,.col-lg-offset-10,.col-lg-offset-11,.col-lg-offset-12,.col-lg-offset-2,.col-lg-offset-3,.col-lg-offset-4,.col-lg-offset-5,.col-lg-offset-6,.col-lg-offset-7,.col-lg-offset-8,.col-lg-offset-9{box-sizing:border-box;-webkit-box-flex:0;-ms-flex:0 0 auto;flex:none;padding-right:.5rem;padding-left:.5rem}.col-lg{-webkit-box-flex:1;-ms-flex-positive:1;flex-grow:1;-ms-flex-preferred-size:0;flex-basis:0;max-width:100%}.col-lg-1{-ms-flex-preferred-size:8.33333333%;flex-basis:8.33333333%;max-width:8.33333333%}.col-lg-2{-ms-flex-preferred-size:16.66666667%;flex-basis:16.66666667%;max-width:16.66666667%}.col-lg-3{-ms-flex-preferred-size:25%;flex-basis:25%;max-width:25%}.col-lg-4{-ms-flex-preferred-size:33.33333333%;flex-basis:33.33333333%;max-width:33.33333333%}.col-lg-5{-ms-flex-preferred-size:41.66666667%;flex-basis:41.66666667%;max-width:41.66666667%}.col-lg-6{-ms-flex-preferred-size:50%;flex-basis:50%;max-width:50%}.col-lg-7{-ms-flex-preferred-size:58.33333333%;flex-basis:58.33333333%;max-width:58.33333333%}.col-lg-8{-ms-flex-preferred-size:66.66666667%;flex-basis:66.66666667%;max-width:66.66666667%}.col-lg-9{-ms-flex-preferred-size:75%;flex-basis:75%;max-width:75%}.col-lg-10{-ms-flex-preferred-size:83.33333333%;flex-basis:83.33333333%;max-width:83.33333333%}.col-lg-11{-ms-flex-preferred-size:91.66666667%;flex-basis:91.66666667%;max-width:91.66666667%}.col-lg-12{-ms-flex-preferred-size:100%;flex-basis:100%;max-width:100%}.col-lg-offset-0{margin-left:0}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-11{margin-left:91.66666667%}.start-lg{-webkit-box-pack:start;-ms-flex-pack:start;justify-content:flex-start;text-align:start}.center-lg{-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;text-align:center}.end-lg{-webkit-box-pack:end;-ms-flex-pack:end;justify-content:flex-end;text-align:end}.top-lg{-webkit-box-align:start;-ms-flex-align:start;align-items:flex-start}.middle-lg{-webkit-box-align:center;-ms-flex-align:center;align-items:center}.bottom-lg{-webkit-box-align:end;-ms-flex-align:end;align-items:flex-end}.around-lg{-ms-flex-pack:distribute;justify-content:space-around}.between-lg{-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.first-lg{-webkit-box-ordinal-group:0;-ms-flex-order:-1;order:-1}.last-lg{-webkit-box-ordinal-group:2;-ms-flex-order:1;order:1}}</style><link href=https://cdn.jsdelivr.net/gh/joway/blog/index.xml rel=alternate type=application/rss+xml title="Random Thoughts"><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Bree+Serif|Bungee+Shade" rel=stylesheet><script data-cfasync=false>(function(){const n="theme",e=localStorage.getItem(n),t=document.documentElement;if(e==="dark")t.setAttribute("data-theme","dark");else if(e==="system"||!e){const e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches;e&&t.setAttribute("data-theme","dark")}})()</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-53624533-8"></script><script src=https://cdn.jsdelivr.net/gh/joway/homepage/analytics.js></script><article class="post ç®€ä½“ä¸­æ–‡" id=article><div class=row><div class=col-xs-12><div class=site-header><header><div class=header-title><a href=/>Random Thoughts</a></div><div class=header-subtitle>Log something useless, but interesting.</div></header><div class="row end-md header-items"><div class=header-item><a href=https://mailchi.mp/a1a0d59e7a19/joway target=_blank>Subscribe</a></div><div class=header-item><a href=/travel target=_blank>Travel</a></div><div class=header-item><a href=https://joway.io target=_blank>About</a></div><div class=header-item><button id=theme-toggle onclick=toggleTheme() class=theme-toggle>ğŸŒ™</button></div></div><div class=row></div><div class=header-line></div></div><header class=post-header><h1 class=post-title>è®¾è®¡å®ç°é«˜æ€§èƒ½æœ¬åœ°å†…å­˜ç¼“å­˜</h1><div class="row post-desc"><div class=col-xs-6><time class=post-date datetime="2019-11-10 00:00:00 UTC">10 Nov 2019</time></div><div class=col-xs-6><div class=post-author><a target=_blank href>@Joway</a></div></div></div></header><div class="post-content markdown-body"><p>æœ¬åœ°å†…å­˜ç¼“å­˜æ˜¯ä¸€ä¸ªåœ¨åŸºç¡€è½¯ä»¶æ¶æ„ä¸­éå¸¸å¸¸è§çš„åŸºç¡€è®¾æ–½ï¼Œä¹Ÿæ­£å› å…¶è¿‡äºå¸¸è§ï¼Œä»¥è‡³äºå¹³æ—¶å¾ˆå°‘å»æ€è€ƒå®ƒæ˜¯å¦‚ä½•å®ç°çš„ã€‚åœ¨å°šæœªè®¾è®¡ç¼“å­˜ç³»ç»Ÿå‰ï¼Œå®Œå…¨æ²¡æƒ³åˆ°åŸæ¥è¦éœ€è¦è€ƒè™‘å¦‚æ­¤å¤šå¤æ‚çš„äº‹æƒ…ã€‚æœ¬æ–‡å°†ç”±æµ…å…¥æ·±ä»‹ç»å¦‚ä½•è®¾è®¡ä¸€ä¸ªç°ä»£çš„é«˜æ€§èƒ½å†…å­˜ç¼“å­˜ç³»ç»Ÿã€‚<h1 id=ä»€ä¹ˆæ—¶å€™éœ€è¦æœ¬åœ°å†…å­˜ç¼“å­˜>ä»€ä¹ˆæ—¶å€™éœ€è¦æœ¬åœ°å†…å­˜ç¼“å­˜</h1><p>åœ¨å¤§éƒ¨åˆ†ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼Œéƒ½ä¼šä½¿ç”¨è¯¸å¦‚ Redisã€Memcached ç­‰è¿œç¨‹ç¼“å­˜ï¼Œä¸€æ–¹é¢å¯ä»¥é¿å…è‡ªèº«è¿›ç¨‹å†…å­˜å ç”¨è¿‡å¤§è€Œå¯¼è‡´çš„ OOM æˆ– GC é—®é¢˜ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿå¯ä»¥å®ç°å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ä»½ä¸€è‡´çš„ç¼“å­˜æ•°æ®ã€‚ä½†å¯¹äºæŸäº›åº•å±‚æœåŠ¡ï¼ˆä¾‹å¦‚æ•°æ®åº“æœåŠ¡ï¼‰ï¼Œè¿œç¨‹ç¼“å­˜çš„ç½‘ç»œå»¶è¿Ÿæ˜¯ä¸å¯æ¥å—çš„ï¼Œè¿™å°±åŠ¿å¿…éœ€è¦å¼•å…¥æœ¬åœ°å†…å­˜ç¼“å­˜ã€‚<h1 id=æœ¬åœ°å†…å­˜ç¼“å­˜çš„ç‰¹ç‚¹>æœ¬åœ°å†…å­˜ç¼“å­˜çš„ç‰¹ç‚¹</h1><p>æœ¬åœ°å†…å­˜ç¼“å­˜å¯è¢«è§†ä½œä¸€ä¸ªåŸºäºæœ¬åœ°å†…å­˜çš„ ã€ŒKeyValue æ•°æ®åº“ã€ã€‚ä½†ç›¸æ¯”è¾ƒäºä¼ ç»Ÿæ•°æ®åº“è€Œè¨€ï¼Œå®ƒå¯¹ä¸€è‡´æ€§çš„è¦æ±‚ååˆ†å®½æ¾ï¼š<ol><li>å¯¹äºæ›´æ–°ä¸åˆ é™¤çš„æ“ä½œï¼Œéœ€è¦ä¿è¯å¼ºä¸€è‡´æ€§<li>å¯¹äºæ’å…¥æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ä¸¢å¤±<li>å¯¹äºè¯»å–æ“ä½œå¯ä»¥å®¹å¿å°‘é‡ Miss</ol><p>ä¸ç£ç›˜æ•°æ®åº“çš„å¦ä¸€ä¸ªä¸åŒä¹‹å¤„åœ¨äºï¼Œç£ç›˜æ•°æ®åº“çš„è®¾è®¡æœ‰ä¸€ä¸ªå‰æå‡è®¾æ˜¯ç£ç›˜æ˜¯å¯ä»¥éšéœ€è¦è€Œä¸æ–­æ‰©å®¹çš„ï¼Œå€˜è‹¥ä¸€ä¸ªç£ç›˜æ•°æ®åº“å› ç£ç›˜å æ»¡è€Œå´©æºƒä¸»è¦è´£ä»»æ˜¯åœ¨ä½¿ç”¨æ–¹ã€‚è€Œå†…å­˜ç¼“å­˜åˆ™æ²¡æœ‰è¿™ä¹ˆå®½å®¹çš„å‡è®¾å¯ä»¥å»ºç«‹ï¼Œå®ƒå¿…é¡»è€ƒè™‘åˆ°å†…å­˜æ˜¯æ˜‚è´µä¸”æœ‰é™çš„è¿™ä¸€äº‹å®ã€‚<p>é™¤æ­¤ä¹‹å¤–ï¼Œç”±äºæœ¬åœ°å†…å­˜ç¼“å­˜å¤„äºä¸šåŠ¡è¿›ç¨‹å½“ä¸­ï¼Œæ‰€ä»¥å…¶éœ€è¦è€ƒè™‘æ›´å¤šä¸šåŠ¡å‘çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼š<ol><li>ç”±äºè‡ªèº«å¤§é‡è€ç”Ÿä»£çš„å†…å­˜å ç”¨ï¼Œæ˜¯å¦ä¼šå¯¹æ‰€å¤„è¿›ç¨‹äº§ç”Ÿ GC é—®é¢˜ã€‚<li>å½“å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¦‚ä½•åŒæ—¶è§£å†³çº¿ç¨‹å®‰å…¨ã€æ•°æ®ç«äº‰ã€é«˜ååç­‰é—®é¢˜ã€‚<li>éœ€è¦èƒ½å¤Ÿé€‚åº”ä¸€äº›ééšæœºçš„è®¿é—®ç»Ÿè®¡è§„å¾‹ï¼Œä¾‹å¦‚ Zipfã€‚</ol><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å½’çº³å‡ºå¯¹ä¸€ä¸ªä¼˜ç§€çš„æœ¬åœ°å†…å­˜ç¼“å­˜ç³»ç»Ÿçš„è¦æ±‚ï¼š<ol><li>çº¿ç¨‹å®‰å…¨<li>é«˜åå<li>é«˜å‘½ä¸­ç‡<li>æ”¯æŒå†…å­˜é™åˆ¶</ol><h1 id=å®ç°è·¯å¾„>å®ç°è·¯å¾„</h1><p>åœ¨å®ç°ä¸€ä¸ªå®Œæ•´çš„ç¼“å­˜ç³»ç»Ÿå‰ï¼Œæˆ‘ä»¬éœ€è¦å°†ç›®æ ‡ä¸€æ­¥æ­¥æ‹†è§£ã€‚<p>é¦–å…ˆä¸ºäº†å®ç°ç¼“å­˜é€»è¾‘ï¼Œæˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç±» Map çš„ KeyValue æ•°æ®ç»“æ„ï¼ŒåŒæ—¶å®ƒå¿…é¡»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä¸ºäº†æ”¯æŒå†…å­˜é™åˆ¶ï¼Œæˆ‘ä»¬å¿…é¡»è¦èƒ½å¤Ÿé©±é€ä¸€äº› keyï¼Œæ‰€ä»¥éœ€è¦å®ç°ä¸€ä¸ªé©±é€å™¨ã€‚ä¸ºäº†å®ç°é©±é€çš„åŒæ—¶ç»´æŒé«˜å‘½ä¸­ç‡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å‘Šè¯‰é©±é€å™¨æ¯ä¸ª key çš„è®¿é—®è®°å½•ï¼Œè®©å®ƒèƒ½å¤Ÿä»ä¸­åˆ†æå‡ºå“ªäº› key å¯ä»¥è¢«é©±é€ã€‚ç»¼ä¸Šåˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ•´ç†å‡ºä¸€ä¸ªå¤§æ¦‚çš„ Roadmapï¼š<ol><li>å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Map æ•°æ®ç»“æ„ï¼šå­˜å‚¨ç¼“å­˜å†…å®¹<li>å®ç°ä¸€ä¸ªè®¿é—®è®°å½•é˜Ÿåˆ—ï¼šå­˜å‚¨è®¿é—®è®°å½•<li>å®ç°ä¸€ä¸ªé©±é€å™¨ï¼šç®¡ç†ç¼“å­˜å†…å®¹</ol><p>æœ¬æ–‡æ‰€æœ‰ä»£ç å‡ä½¿ç”¨ Golang ç¼–å†™ã€‚<h2 id=çº¿ç¨‹å®‰å…¨çš„-map>çº¿ç¨‹å®‰å…¨çš„ Map</h2><h3 id=ç®€æ˜“çš„-map>ç®€æ˜“çš„ Map</h3><pre><code>cache := map[string]string{}
cache[&quot;a&quot;] = &quot;b&quot;
</code></pre><p>åœ¨ key æ•°é‡å›ºå®šä¸”æå°‘çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨åŸç”Ÿ Map ç›´æ¥å®ç°ä¸€ä¸ªæœ€ç®€å•ç¼“å­˜ã€‚ä½† Golang åŸç”Ÿ Map å¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå½“å¤šä¸ª goroutine åŒæ—¶è¯»å†™è¯¥å¯¹è±¡æ—¶ï¼Œä¼šå‘ç”Ÿå†²çªã€‚<h3 id=çº¿ç¨‹å®‰å…¨çš„-safemap>çº¿ç¨‹å®‰å…¨çš„ SafeMap</h3><pre><code>type SafeMap struct {
	lock  sync.Mutex
	store map[string]string
}

func (m *SafeMap) Get(k string) string {
	m.lock.Lock()
	defer m.lock.Unlock()

	return m.store[k]
}

func (m *SafeMap) Set(k, v string) {
	m.lock.Lock()
	defer m.lock.Unlock()

	m.store[k] = v
}
</code></pre><p>è¿™æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„çº¿ç¨‹å®‰å…¨ Map å®ç°ã€‚å¯¹äºè®¿é—®é‡å¾ˆå°çš„ç³»ç»Ÿï¼Œè¿™å·²ç»èƒ½å¤Ÿæˆä¸ºä¸€ä¸ªéå¸¸æ–¹ä¾¿å¿«é€Ÿçš„å®ç°äº†ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ª Map æ˜¯è¢«è¯¥è¿›ç¨‹ä¸‹çš„æ‰€æœ‰çº¿ç¨‹æ‰€å…±äº«çš„ï¼Œä»»ä½•ä¸€ä¸ªä¿®æ”¹éƒ½éœ€è¦å»ç«äº‰å¾—åˆ°ä¸€ä¸ªé”ï¼Œå¦‚æœå¥—ç”¨æ•°æ®åº“é¢†åŸŸçš„æ¦‚å¿µï¼Œè¿™ä¸ªé”å°±æ˜¯æ•°æ®åº“çº§åˆ«çš„é”ï¼Œæ˜¾ç„¶å¯¹äºå¹¶å‘é‡å¤§çš„æ—¶å€™æ˜¯ä¸é€‚åˆçš„ï¼Œä¼šæˆä¸ºæ•´ä¸ªç³»ç»Ÿçš„ç“¶é¢ˆã€‚<h3 id=åˆ†æ®µé”çš„-safemap>åˆ†æ®µé”çš„ SafeMap</h3><pre><code>type SafeMap struct {
	locks []*sync.Mutex
	store []map[string]string
}

func NewSafeMap() SafeMap {
	return SafeMap{
		locks: []*sync.Mutex{{}, {}, {}},
		store: []map[string]string{{}, {}, {}},
	}
}

func hash(k string) int {
	h := fnv.New32a()
	h.Write([]byte(k))
	return int(h.Sum32())
}

func (m *SafeMap) GetLock(k string) *sync.Mutex {
	idx := hash(k) % len(m.locks)
	return m.locks[idx]
}

func (m *SafeMap) GetStore(k string) map[string]string {
	idx := hash(k) % len(m.locks)
	return m.store[idx]
}

func (m *SafeMap) Get(k string) string {
	lock := m.GetLock(k)
	lock.Lock()
	defer lock.Unlock()

	return m.GetStore(k)[k]
}

func (m *SafeMap) Set(k, v string) {
	lock := m.GetLock(k)
	lock.Lock()
	defer lock.Unlock()

	m.GetStore(k)[k] = v
}
</code></pre><p>ä¸€ä¸ªå¾ˆè‡ªç„¶çš„æƒ³æ³•æ˜¯å°† key è¿›è¡Œåˆ†æ¡¶ï¼Œä»è€Œåˆ†æ•£å¯¹é”çš„ç«äº‰ã€‚è¿™ç§æ–¹æ³•ç±»ä¼¼äºå°†ã€Œæ•°æ®åº“é”ã€æ‰“æ•£æˆã€Œè¡¨é”ã€ã€‚åˆ°è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬åŸºæœ¬å·²ç»å®Œæˆäº†ä¸€ä¸ªæœ€ç®€å•çš„é«˜å¹¶å‘ç¼“å­˜ã€‚<h3 id=è¯»å†™åˆ†æ®µé”çš„-safemap>è¯»å†™åˆ†æ®µé”çš„ SafeMap</h3><p>è€ƒè™‘åˆ°ç¼“å­˜ç³»ç»Ÿè¯»è¿œå¤§äºå†™ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸Šè¿° Map çš„äº’æ–¥é” <code>Mutex</code> æ”¹ä¸º <code>RWMutex</code> ï¼Œä»è€Œä½¿å¾—è¯»æ—¶å¹¶ä¸äº’æ–¥ï¼Œæ”¹å–„è¯»æ€§èƒ½ã€‚<h3 id=ä½¿ç”¨çº¿ç¨‹-id-å®ç°æ— é”>ä½¿ç”¨çº¿ç¨‹ ID å®ç°æ— é”</h3><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸Šè¿° Map ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„åˆ†æ¡¶æ–¹æ³•æ˜¯åˆ©ç”¨ key åšéšæœºå“ˆå¸Œï¼Œè¿™ç§åšæ³•åªèƒ½ç¼“è§£é”ç«äº‰çš„é—®é¢˜ï¼Œå´æ— æ³•æ ¹æ²»ã€‚é‚£ä¹ˆæ˜¯å¦æœ‰åŠæ³•æ ¹æ²»è¿™é‡Œçš„é”ç«äº‰å‘¢ï¼Ÿ<p>åŠæ³•å’Œä»£ä»·éƒ½æ˜¯æœ‰çš„ã€‚å¦‚æœæˆ‘ä»¬å¯ä»¥è®©æŸä¸€å—å†…å­˜åªè¢«æŸä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆå°±å¯ä»¥å®Œå…¨é¿å…è¿™äº›çº¿ç¨‹ä¹‹é—´çš„é”ç«äº‰ï¼Œä»è€Œå®ç°æ— é”ã€‚å‡è®¾æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹IDï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰çº¿ç¨‹IDå»åˆ†æ®µï¼Œæ¯ä¸ªçº¿ç¨‹ç‹¬å ä¸€ä¸ª SafeMapã€‚<p>è¿™æ ·åšè™½ç„¶é¿å…äº†é”ï¼Œä½†ä¹ŸåŒæ—¶é€ æˆäº†æ•°æ®ã€Œè†¨èƒ€ã€ã€‚å¦‚æœåŒä¸€ä¸ª key è¢«Nä¸ªçº¿ç¨‹ Set äº†å¤šæ¬¡ï¼Œæ­¤æ—¶å†…å­˜ä¸­å°±å¤šäº† N ä»½åŒæ ·çš„æ•°æ®ã€‚å¦‚æœå®ƒåªè¢« Set äº†ä¸€æ¬¡ï¼Œä¹Ÿå°†å¯¼è‡´å…¶ä»–çº¿ç¨‹æ²¡æ³•å–å¾—è¿™ä¸ªæ•°æ®ï¼Œä»è€Œå‡ºç°éå¸¸é«˜çš„ Miss ç‡ã€‚ä½†å¯¹äºé‚£äº›æå…¶çƒ­é—¨çš„å°‘é‡ keyï¼Œè¿™ç§æ–¹å¼çš„ç¡®å¯ä»¥ä½œä¸ºä¸€ç§ä¼˜åŒ–é€‰æ‹©ã€‚<p>ä»¤äººé—æ†¾çš„æ˜¯ï¼Œåœ¨ Golang ä¸­ï¼Œç”±äº GPM è°ƒåº¦æ¨¡å‹çš„å­˜åœ¨ï¼Œåœ¨ Runtime ä¸­å±è”½äº†çº¿ç¨‹æ‰€æœ‰ç›¸å…³ä¿¡æ¯ï¼Œæ‰€ä»¥æˆ‘ä»¬æ˜¯æ²¡æœ‰æ­£å¸¸çš„åŠæ³•è·å¾—ã€Œçº¿ç¨‹IDã€çš„ä¿¡æ¯ï¼Œå› è€Œæ­¤æ–‡æš‚ä¸è€ƒè™‘ä¸Šè¿°æ–¹æ¡ˆã€‚<h3 id=ä½¿ç”¨-syncmap-å®ç°æ— é”>ä½¿ç”¨ sync.Map å®ç°æ— é”</h3><p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/02.png alt><blockquote><p>å›¾ç‰‡æ¥æº: <a href=https://halfrost.com/go_map_chapter_two/>å¦‚ä½•è®¾è®¡å¹¶å®ç°ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„ Map ï¼Ÿ(ä¸‹ç¯‡)</a></blockquote><p>å‡†ç¡®æ¥è¯´ï¼Œ<code>sync.Map</code> å¹¶ä¸æ˜¯å®Œå…¨çš„ã€Œæ— é”ã€ï¼Œåªæ˜¯ä¸€ä¸ªåœ¨ç»å¤§éƒ¨åˆ†è¯»åœºæ™¯æ˜¯æ— é”çš„çº¿ç¨‹å®‰å…¨ Mapã€‚å…·ä½“åŸç†å¯ä»¥å‚è§ç›¸å…³æ–‡æ¡£ã€‚ä½†ç”±äºå…¶åº•å±‚å®ç°å¹¶æœªé‡‡å–åˆ†æ®µé”çš„æ–¹æ³•ï¼Œæ‰€ä»¥å†™çš„æ—¶å€™ä¼šæœ‰ä¸€ä¸ª dirty ä¸Šçš„å…¨å±€é”ï¼Œè¿›è€Œä¼šå½±å“åˆ°é«˜å¹¶å‘å†™æ—¶çš„æ€§èƒ½ã€‚æ‰€ä»¥å¯¹äºä¸åœ¨ä¹å†™æ€§èƒ½åŒæ—¶å†™ä¹Ÿç›¸å¯¹ä¸å¯†é›†çš„æ—¶å€™ï¼Œè¯¥æ•°æ®ç»“æ„æ˜¯éå¸¸ç†æƒ³çš„é€‰æ‹©ã€‚<h3 id=è®¾è®¡>è®¾è®¡</h3><p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/01.png alt><h2 id=è®¿é—®è®°å½•é˜Ÿåˆ—>è®¿é—®è®°å½•é˜Ÿåˆ—</h2><p>å¯¹äºè®¿é—®è®°å½•çš„è¯»å†™ï¼ŒåŒæ ·ç‰µæ¶‰åˆ°å¤šçº¿ç¨‹åŒæ—¶æ“ä½œåŒä¸€ä¸ªå†…å­˜åœ°å€çš„æƒ…å†µã€‚ä½†æˆ‘ä»¬å¯¹å…¶ä¸€è‡´æ€§ä¼šæ¯”ç¼“å­˜å†…å®¹å­˜å‚¨æ›´ä½ï¼Œå°¤å…¶æ˜¯åœ¨é«˜å¹¶å‘æ•°æ®çš„å‡è®¾ä¸‹ï¼Œå°‘é‡çš„æ•°æ®ä¸¢å¤±å¹¶ä¸ä¼šå½±å“æœ€ç»ˆåˆ¤æ–­ç»“æœã€‚<p>ä¸ç¼“å­˜å†…å®¹å­˜å‚¨çš„åœºæ™¯ä¸åŒçš„æ˜¯ï¼Œå¯¹äºè®¿é—®è®°å½•ï¼Œæ¯æ¬¡ Get/Set çš„æ—¶å€™éƒ½ä¼šéœ€è¦è¿›è¡Œä¸€æ¬¡å†™å…¥æ“ä½œï¼Œæ‰€ä»¥å®ƒçš„å†™é€Ÿåº¦è¦æ±‚è¿œé«˜äºå‰é¢çš„ç¼“å­˜å†…å­˜å­˜å‚¨ã€‚æ›´ä¸ºå…³é”®çš„æ˜¯ï¼Œå³ä¾¿æ˜¯åœ¨å¦‚æ­¤é«˜å¯†åº¦çš„å†™æƒ…å†µä¸‹ï¼Œå®ƒä¹ŸåŒæ ·éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚<p>è™½ç„¶ä¸Šè¿°è¦æ±‚çœ‹ä¼¼ååˆ†å¤æ‚ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥è¯•ç€é€šè¿‡å‡ ä¸ªæ–¹é¢çš„åˆ†æï¼Œæ¥æ‹†è§£è¿™ä¸ªé—®é¢˜ã€‚<p>åœ¨æ€§èƒ½æ–¹é¢ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯è¯¥æ•°æ®ç»“æ„å†™å…¥æ—¶æ˜¯æ— é”çš„ï¼Œå› ä¸ºä¸€æ—¦æœ‰é”ï¼Œå‰é¢åšçš„é™ä½é”é¢—ç²’åº¦ä¼˜åŒ–éƒ½ä¼šè¢«è¿™ä¸ªæœ‰é”çš„ç»“æ„ç»™æ‹–ç´¯ã€‚<p>åœ¨å†™å…¥æ–¹å¼æ–¹é¢ï¼Œç”±äºæˆ‘ä»¬å¯ä»¥æ¥å—å°‘é‡æ•°æ®ä¸¢å¤±ï¼Œå¹¶ä¸”æˆ‘ä»¬æ²¡æœ‰éå¸¸å®æ—¶çš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¥å—å¼‚æ­¥çš„å†™å…¥ã€‚<p>åœ¨å­˜å‚¨å†…å®¹æ–¹é¢ï¼Œæˆ‘ä»¬åªéœ€è¦å­˜å‚¨ Key æ•°æ®ã€‚<p>æ ¹æ®ä¸Šè¿°åˆ†æï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°æˆ‘ä»¬éœ€è¦çš„æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„çº¿ç¨‹å®‰å…¨çš„æ— é” Lossy é˜Ÿåˆ—ã€‚ä½†ä¼¼ä¹å¹¶æ²¡æœ‰ç°æˆçš„è¿™ç§æ•°æ®ç»“æ„å®ç°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€€ä¸€æ­¥å°†è¿™ä¸ªé—®é¢˜å˜æˆï¼Œå…ˆå®ç°ä¸€ä¸ª Lossy é˜Ÿåˆ—ï¼Œå†åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå®ç°çº¿ç¨‹å®‰å…¨çš„åŠŸèƒ½ã€‚<h3 id=ç¯å½¢ç¼“å†²ringbuffer>ç¯å½¢ç¼“å†²ï¼šRingBuffer</h3><p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/05.png alt><p>RingBuffer æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„ç¯å½¢ç¼“å†²é˜Ÿåˆ—ï¼Œç”±ä¸€ä¸ªæ•°ç»„ï¼ŒåŠ ä¸Šä¸€ä¸ªè¯»æŒ‡é’ˆå’Œå†™æŒ‡é’ˆæ„æˆã€‚è¯»æŒ‡é’ˆæ°¸è¿œåªèƒ½è¯»åˆ°å†™æŒ‡é’ˆå‰çš„æ•°æ®ã€‚<h3 id=çº¿ç¨‹å®‰å…¨æ”¯æŒsyncpool>çº¿ç¨‹å®‰å…¨æ”¯æŒï¼šsync.Pool</h3><p>Golang è‡ªå¸¦çš„ <code>sync.Pool</code> å¯ä»¥éå¸¸å¥½åœ°å’Œ Ring Buffer ååŒå·¥ä½œï¼Œå®ç°åœ¨è¿‘ä¹æ— é”çš„æƒ…å†µä¸‹ï¼Œæ„é€ å‡ºä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é«˜ååç¼“å†²é˜Ÿåˆ—ã€‚<p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/06.png alt><blockquote><p>å›¾ç‰‡æ¥æºï¼š<a href=https://programmer.group/a-brief-analysis-of-golang-sync.pool.html>A Brief Analysis of Golang Sync.Pool</a></blockquote><p><code>sync.Pool</code> ä¼šåœ¨æ¯ä¸ªçº¿ç¨‹ä¸­ç»´æŠ¤ä¸€ä¸ª private çš„ Poolï¼ˆæ— é”ï¼‰ï¼Œä»¥åŠä¸€ä¸ªå¯ä»¥è¢«å…¶ä»–çº¿ç¨‹ sharedçš„ Poolï¼ˆæœ‰é”ï¼‰ï¼Œç»†èŠ‚åŸç†å¯ä»¥å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå®ƒåŸºæœ¬èƒ½å¤Ÿä¿è¯æ¯ä¸ªçº¿ç¨‹éƒ½èƒ½å¤Ÿè·å¾—ä¸€ä¸ªçº¿ç¨‹ç§æœ‰çš„ RingBuffer å¯¹è±¡ï¼Œä»è€Œä¸éœ€è¦å¯¹å…¶åŠ é”ã€‚ä½† <code>sync.Pool</code> æœ‰ä¸€ä¸ªç¼ºç‚¹æ˜¯åœ¨ GC æ—¶ä¼šè¢«é‡Šæ”¾æ‰ï¼Œæ­¤æ—¶ä¼šä¸¢å¤±ç¼“å†²åŒºå†…çš„æ•°æ®ã€‚ä¸è¿‡ç”±äºæˆ‘ä»¬çš„å‰æå‡è®¾æ˜¯é«˜å¹¶å‘åœºæ™¯ï¼Œæ•…è€Œå¯ä»¥æ¨å¯¼å‡ºæ•°æ®çš„ä¸¢å¤±é‡è¾ƒä¹‹äºå…¨å±€æ˜¯å¾®ä¹å…¶å¾®çš„ã€‚ç„¶è€Œåœ¨ä½å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¿™ç§åšæ³•æœ‰å¯èƒ½å¯¼è‡´ç¼“å†²åŒºä¸€ç›´è¢« GC æ¸…ç†æ‰è€Œä¸§å¤±å¤§éƒ¨åˆ†ç»Ÿè®¡æ•°æ®ã€‚<p>è¿™é‡Œå¯¹ RingBuffer åšäº†ä¸€äº›ç®€å•çš„æ”¹åŠ¨ï¼Œå½“ç¼“å†²åŒºå†™æ»¡åï¼Œä¼šå°†æ•°æ®äº¤ç»™é©±é€å™¨ç»Ÿè®¡ï¼Œç„¶åæ¸…ç©ºç¼“å†²åŒºã€‚<pre><code>import (
	&quot;sync&quot;
)

type ringStripe struct {
	store    []uint64
	capacity uint64
}

func newRingStripe(capacity uint64) *ringStripe {
	return &amp;ringStripe{
		store:    make([]uint64, 0, capacity),
		capacity: capacity,
	}
}

func (s *ringStripe) PushOrReturn(item uint64) []uint64 {
	s.store = append(s.store, item)
	if uint64(len(s.store)) &gt;= s.capacity {
		ret := s.store[:]
		s.store = make([]uint64, 0, s.capacity)
		return ret
	}
	return nil
}

type ringBuffer struct {
	stripes []*ringStripe
	pool    *sync.Pool
}

func newRingBuffer(capacity uint64) *ringBuffer {
	return &amp;ringBuffer{
		pool: &amp;sync.Pool{
			New: func() interface{} {
				return newRingStripe(capacity)
			},
		},
	}
}

func (b *ringBuffer) PushOrReturn(item uint64) []uint64 {
	stripe := b.pool.Get().(*ringStripe)
	defer b.pool.Put(stripe)
	
	got := stripe.PushOrReturn(item)
	return got
}
</code></pre><h3 id=è®¾è®¡-1>è®¾è®¡</h3><p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/09.png alt><h2 id=é©±é€å™¨>é©±é€å™¨</h2><h3 id=é©±é€ç­–ç•¥>é©±é€ç­–ç•¥</h3><p>é€šè¿‡ä¸åœè¯»è®¿é—®è®°å½•ç¯å½¢ç¼“å†²é˜Ÿåˆ—ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ‹¿åˆ°ç”¨æˆ·çš„è®¿é—®è®°å½•ã€‚æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ç§é©±é€ç­–ç•¥ï¼š<ul><li>LRUï¼ˆLeast Recently Usedï¼‰ ï¼šæœ€å°‘æœ€è¿‘ä½¿ç”¨ï¼Œå³ç»´æŠ¤ä¸€ä¸ªæ•°ç»„ï¼Œè¶Šé å‰è®¿é—®æ—¶é—´è¶Šè¿‘ã€‚<li>LFU ï¼ˆLeast Frequently Usedï¼‰ï¼šæœ€å°‘é¢‘ç‡ä½¿ç”¨ï¼Œå³éœ€è¦è®°å½• Key ä½¿ç”¨çš„é¢‘ç‡ï¼Œè¶Šä½è¶Šå®¹æ˜“è¢«é©±é€ã€‚</ul><p>LRU çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœåœ¨æŸä¸ªæ•°æ®åœ¨å‰9åˆ†é’Ÿè®¿é—®äº†1ä¸‡æ¬¡ï¼Œæœ€è¿‘1åˆ†é’Ÿæ²¡æœ‰è®¿é—®ï¼Œé‚£ä¹ˆä¾ç„¶ä¼šè®¤ä¸ºè¯¥ key å¹¶ä¸çƒ­é—¨è€Œæœ‰å¯èƒ½è¢«é©±é€ã€‚<p>LFU çš„é—®é¢˜åœ¨äºï¼Œç»å¸¸ä¼šæœ‰ä¸€äº›æ•°æ®åœ¨æŸæ—¶åˆ»éå¸¸æå…¶çƒ­é—¨ï¼Œä½†ä¹‹åä¸€ç›´æ²¡äººè®¿é—®ï¼Œä¾‹å¦‚å› ä¸ºæŸäº›åŸå› è¢«éšè—çš„ç”¨æˆ·åŠ¨æ€è¿™ç±»åœºæ™¯ã€‚å¦å¤–ï¼ŒLFU çš„é¢‘ç‡ä¿¡æ¯åœ¨ç¼“å­˜å¤±æ•ˆåä¾æ—§ä¼šå­˜åœ¨å†…å­˜ä¸­ã€‚<p>å€¼å¾—æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œç¼“å­˜ç³»ç»Ÿçš„é©±é€å¾€å¾€æ˜¯ç”±äºå†™å…¥è€Œå¼•èµ·çš„ï¼Œæ¢å¥è¯è¯´ï¼Œæ˜¯ä¸ºäº†åœ¨ç¼“å­˜ä¸­ï¼Œç»™æ›´åŠ é‡è¦çš„ key è…¾å‡ºç©ºé—´ï¼Œæ‰é©±é€å‡ºé‚£äº›æ²¡å®ƒé‡è¦çš„ keyã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œæ— è®ºæ˜¯ LRU è¿˜æ˜¯ LFU çš„å†™å…¥è¿‡ç¨‹ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªå‡è®¾æ˜¯æ–°æ¥çš„ key ä¸€å®šæ˜¯æ›´é‡è¦çš„ï¼Œä»¥è‡³äºæˆ‘å¿…é¡»ç‰ºç‰²æ‰æŸä¸ªå·²æœ‰çš„ keyã€‚ä½†è¿™ä¸ªå‡è®¾å¾ˆå¯èƒ½æ˜¯ä¸æˆç«‹çš„ã€‚è€Œä¸”è¿™ç§æ–¹å¼å¾ˆå®¹æ˜“å¯¼è‡´ä¸€äº›å†·é—¨æ•°æ®åœ¨çŸ­æ—¶é—´è¿‡çƒ­å¯¼è‡´ç¼“å­˜ç³»ç»Ÿè¿…é€Ÿé©±é€å‡ºäº†åŸå…ˆçš„é‚£äº›çƒ­é—¨æ•°æ®ã€‚ä¸ºäº†è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œäºæ˜¯å°±æœ‰äº† TinyLFUã€‚<p>TinyLFU åˆ©ç”¨ LFU ä½œä¸ºå†™å…¥è¿‡æ»¤å™¨ï¼Œåªæœ‰å½“æ–°æ¥çš„ key çš„é¢‘ç‡å¤§äºéœ€è¦è¢«é©±é€çš„ key æ—¶ï¼Œæ­¤æ—¶æ‰ä¼šæ‰§è¡Œå†™å…¥ï¼Œå¦åˆ™åªè¿›è¡Œé¢‘ç‡ä¿¡æ¯çš„ç´¯åŠ ã€‚ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰æ–°çš„ key éƒ½ä¼šæœ‰ä¸€ä¸ªè¢«é¢„çƒ­çš„è¿‡ç¨‹æ‰èƒ½å¤Ÿã€Œå¤Ÿæ ¼ã€è¢«å†™å…¥ç¼“å­˜ä¸­ã€‚<p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/08.png alt><p>ä½†æ­¤æ—¶ä¼šå­˜åœ¨çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œå½“æœ‰çªå‘æ€§çš„ç¨€ç–æµé‡ï¼ˆsparse burstsï¼‰è¿›æ¥æ—¶ï¼Œä»–ä»¬ä¼šç”±äºä¸€ç›´æ— æ³•å»ºç«‹è¶³å¤Ÿçš„é¢‘ç‡ä½¿å¾—è‡ªå·±è¢«ç¼“å­˜ç³»ç»Ÿè€Œæ¥çº³ï¼Œä»è€Œå¯¼è‡´å‡»ç©¿äº†ç¼“å­˜ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œäºæ˜¯åˆæœ‰äº† W-TinyLFUã€‚<p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/04.png alt><p>W-TinyLFU ç®—æ³•å¸æ”¶äº†ä¸Šè¿°ç®—æ³•çš„ä¼˜ç‚¹ï¼Œåœ¨ TinyLFU å‰é¢æ”¾äº†ä¸€ä¸ªåŸºäº LRU çš„ Window Cacheï¼Œä»è€Œå¯ä»¥ä½¿å¾—å‰é¢æåˆ°çš„çªå‘æ€§ç¨€ç–æµé‡ä¼šç¼“å­˜åœ¨ Window Cache é‡Œï¼Œåªæœ‰åœ¨ Window Cache é‡Œè¢«æ·˜æ±°çš„ç¼“å­˜æ‰ä¼šè¿‡ç»§ç»™åé¢çš„ TinyLFUã€‚è‡³äºæœ€åçš„ Main Cacheï¼Œè™½ç„¶ W-TinyLFU ä½¿ç”¨äº†åˆ†æ®µå¼ LRU æ¥å®ç°ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ä½¿å…¶ç¬¦åˆæˆ‘ä»¬éœ€è¦çš„åœºæ™¯ã€‚<p>TinyLFU && W-TinyLFU ç®—æ³•æ˜¯ç”± Gil Einzigerã€Roy Friedman å’Œ Ben Manes ä¸‰äººåœ¨ 15 å¹´å…±åŒå†™çš„è®ºæ–‡ï¼š<a href=https://arxiv.org/abs/1512.00727>TinyLFU: A Highly Efficient Cache Admission Policy</a> æ‰€æå‡ºæ¥çš„ï¼Œåæ¥ Ben Manes è¿˜ä¾ç…§è¿™ä¸ªç®—æ³•å†™äº†ä¸€ä¸ª Java é¢†åŸŸå¤‡å—æ¬¢è¿çš„ç¼“å­˜ç³»ç»Ÿ <a href=https://github.com/ben-manes/caffeine>Caffeine</a>ã€‚<p>ä¸ºäº†ç®€åŒ–æœ¬æ–‡çš„å®ç°ï¼Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸å®ç° W-TinyLFU ç®—æ³•ï¼ˆW-TinyLFU çš„å®ç°ä¼šå¦å¤–å†™ä¸€ç¯‡æ–‡ç« ä»‹ç»ï¼‰ï¼Œè€Œæ˜¯å®ç°ä¸€ä¸ªç®€å•çš„ LFU é©±é€ç­–ç•¥ã€‚å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿç”¨æ¥è®°å½•è®¿é—®é¢‘ç‡çš„æ•°æ®ç»“æ„ã€‚åŒæ—¶ç”±äºæˆ‘ä»¬éœ€è¦å­˜å‚¨æ‰€æœ‰ key çš„ä¿¡æ¯ï¼Œæ‰€ä»¥è¿˜éœ€è¦è¿™ä¸ªæ•°æ®ç»“æ„èƒ½å¤Ÿæœ‰æ•ˆå‡å°‘ key çš„å­˜å‚¨ä½“ç§¯ã€‚<p>å³ä¾¿æœ‰äº†ä¸Šé¢çš„é¢‘ç‡è®¡æ•°å™¨ï¼Œä¸ºäº†æ‰¾åˆ°é‚£ä¸ªéœ€è¦è¢«é©±é€çš„ LFU keyï¼Œæˆ‘ä»¬ä¼¼ä¹éœ€è¦éå†æ‰€æœ‰ keyã€‚æ‰€ä»¥æˆ‘ä»¬ä¸å¾—ä¸å†å¼•å…¥ä¸€ä¸ªé©±é€å€™é€‰åˆ—è¡¨æ¥å¸®åŠ©æˆ‘ä»¬æå‰æ’åºå¥½éœ€è¦é©±é€çš„ keyã€‚<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†å®ç°ï¼š<ol><li>èƒ½å¤Ÿæœ‰æ•ˆå‹ç¼©æ•°æ®å¤§å°çš„é¢‘ç‡è®¡æ•°å™¨<li>é¢„å…ˆæ’åºçš„é©±é€å€™é€‰æ± </ol><h3 id=é¢‘ç‡è®¡æ•°å™¨count-min-sketch>é¢‘ç‡è®¡æ•°å™¨ï¼šCount-Min Sketch</h3><p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/03.png alt><p>Count-Min ç®—æ³•å’Œå¸ƒéš†è¿‡æ»¤å™¨ç±»ä¼¼ï¼Œæ ¸å¿ƒæ€æƒ³è¿˜æ˜¯é€šè¿‡å°†ç›¸åŒ Hash å€¼çš„æ•°æ®å…±äº«åŒä¸€ä»½å­˜å‚¨ç©ºé—´ï¼Œä»¥å‡å°æ•´ä½“ä½“ç§¯ã€‚h1~hd ä»£è¡¨ä¸åŒçš„ Hash ç®—æ³•ï¼Œè¿™é‡Œçš„ value ä»£è¡¨æˆ‘ä»¬è¦å­˜å‚¨çš„ keyï¼Œæ¨ªåæ ‡è¡¨ç¤º Hash åçš„å€¼ï¼Œå¯¹å“ˆå¸Œå€¼å¯¹åº”æ¯ä¸ªç½‘æ ¼è¿›è¡Œ +1 æ“ä½œã€‚å½“éœ€è¦è®¡ç®—æŸä¸ª key çš„ä¼°è®¡å€¼æ—¶ï¼Œå–å¯¹åº”æ‰€æœ‰ç½‘æ ¼æ•°å€¼çš„æœ€å°å€¼ã€‚<p>ä¸ºäº†é¿å…ä¸€äº›çŸ­æ—¶é—´çƒ­åº¦çš„ key ä¸€ç›´æ®‹ç•™åœ¨ç¼“å­˜ä¸­ï¼Œæ¯éš”ä¸€ä¸ªæ—¶é—´é—´éš”ï¼Œè¿˜éœ€è¦å°†æ‰€æœ‰ç½‘æ ¼è®¡æ•°å™¨è¡°å‡ä¸€åŠã€‚<h3 id=è®¾è®¡-2>è®¾è®¡</h3><p><img src=https://ik.imagekit.io/elsetech/blog/images/modern-memory-cache/07.png alt><h1 id=æ€»ç»“>æ€»ç»“</h1><p>ç»è¿‡ä¸€ç³»åˆ—çš„æ­¥éª¤ï¼Œæˆ‘ä»¬ç»ˆäºå®ç°äº†ä¸€ä¸ªæ»¡è¶³æˆ‘ä»¬è¦æ±‚çš„ç°ä»£å†…å­˜ç¼“å­˜ç³»ç»Ÿã€‚å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ç¼“å­˜ç³»ç»Ÿçš„è®¾è®¡ä¸­ï¼Œå¯¹æ€§èƒ½å½±å“æœ€å¤§çš„æ˜¯ç¼“å­˜çš„å­˜å‚¨å±‚ï¼Œéœ€è¦éå¸¸å°å¿ƒåœ°è¿›è¡Œé”çš„è®¾è®¡å’Œä¼˜åŒ–ã€‚è€Œå¯¹äºç¼“å­˜ç³»ç»Ÿå‘½ä¸­ç‡å½±å“æœ€å¤§ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å®ç°ç®—æ³•ä¸Šæœ€å¤æ‚çš„è¿˜æ˜¯æ·˜æ±°ç­–ç•¥çš„é€‰æ‹©ã€‚ç°ä»£çš„è®¸å¤šå†…å­˜ç¼“å­˜ç³»ç»Ÿæ‰€é€‰æ‹©çš„æ·˜æ±°ç­–ç•¥å„æœ‰ä¸åŒï¼Œè®¸å¤šéƒ½åœ¨ç°æœ‰çš„ç®—æ³•åŸºç¡€ä¸Šåšè¿‡ä¸€äº›è‡ªå·±çš„ä¿®æ”¹ã€‚å³ä¾¿ä¸€äº›ç¼“å­˜ç³»ç»Ÿåœ¨ Benchmark ä¸­éå¸¸ä¼˜ç§€ï¼Œä½†å¦‚æœå…¶æµ‹è¯•æ•°æ®è®¿é—®æ¨¡å¼ä¸ä½ çš„å®é™…ä½¿ç”¨åœºæ™¯å¹¶ä¸ä¸€è‡´ï¼Œå®ƒçš„æ•°æ®å¯¹ä½ çš„å‚è€ƒæ„ä¹‰ä¹Ÿå¹¶ä¸å¤§ã€‚æ‰€ä»¥ä¾æ—§éœ€è¦é’ˆå¯¹æ€§åœ°è¿›è¡Œæ¨¡æ‹Ÿå‹æµ‹æ‰èƒ½å¤ŸçŸ¥é“ä»€ä¹ˆæ ·çš„ç¼“å­˜ç³»ç»Ÿé€‚åˆä½ ä¸šåŠ¡çš„åœºæ™¯ã€‚<h1 id=å‚è€ƒèµ„æ–™>å‚è€ƒèµ„æ–™</h1><ul><li><a href=http://highscalability.com/blog/2016/1/25/design-of-a-modern-cache.html>Design Of A Modern Cache</a><li><a href=https://arxiv.org/abs/1512.00727>TinyLFU: A Highly Efficient Cache Admission Policy</a><li><a href=https://blog.dgraph.io/post/introducing-ristretto-high-perf-go-cache/>Introducing Ristretto: A High-Performance Go Cache</a><li><a href=https://blog.dgraph.io/post/caching-in-go/>The State of Caching in Go</a><li><a href=https://juejin.im/post/5b7593496fb9a009b62904fa>ä½ åº”è¯¥çŸ¥é“çš„ç¼“å­˜è¿›åŒ–å²</a></ul></div><div class="row middle-xs"><div class=col-xs-12></div></div><div class=row><div class=col-xs-12><br><br><p>Subscribeï¼š<a target=_blank href=https://mailchi.mp/a1a0d59e7a19/joway><b>Mailchimp</b></a></p><br><a rel=license href=http://creativecommons.org/licenses/by-nc-nd/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://blog.joway.io/images/cc.png></a></div></div><div style=height:50px></div><div class=post-comments><div id=disqus_thread></div><script>window.addEventListener("load",()=>{(function(){var e=document,t=e.createElement("script");t.src="https://joway.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(e.head||e.body).appendChild(t)})()})</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript></div><div class=site-footer></div></div></div></article><script src=https://cdn.jsdelivr.net/gh/joway/blog/js/lazyload.min.js></script><script>var lazyImage=new LazyLoad({container:document.getElementById("article")})</script><script>(function(){const o="theme",e={light:"light",dark:"dark",system:"system"};function t(){return window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}function s(){return localStorage.getItem(o)}function n(n){const s=document.documentElement;n===e.system&&(n=t()),n===e.dark?s.setAttribute("data-theme","dark"):s.removeAttribute("data-theme"),i(n)}function i(e){const t=document.getElementById("theme-toggle");t&&(t.textContent=e==="dark"?"â˜€ï¸":"ğŸŒ™")}function a(){const o=s();let i;o?(i=o===e.system?t():o,n(o)):(i=t(),n(e.system))}function r(){const a=s()||e.system;let i;a===e.system?i=t()==="dark"?e.light:e.dark:a===e.dark?i=e.light:i=e.dark,localStorage.setItem(o,i),n(i)}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",function(){const t=s();(!t||t===e.system)&&n(e.system)}),window.toggleTheme=r,a()})()</script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("disqus_thread");if(!e)return;const t=new MutationObserver(function(n){n.forEach(function(){const n=e.getElementsByTagName("iframe");if(n.length>1){const s=n[1];for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(s),t.disconnect()}})});t.observe(e,{childList:!0,subtree:!0})})</script>